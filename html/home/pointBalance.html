<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.css" rel="stylesheet" />
		<style>
			* {
				padding: 0;
				margin: 0;
			}

			html,
			body {
				height: 100%;
				width: 100%;
				touch-action: none;
				/* overflow: hidden; */
			}
		</style>
		<script src="../../js/mui.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/pointBalance.js"></script>
		<script src="../../js/environment.js"></script>
	</head>

	<body>
		<script type="text/javascript">
			
			mui.init();
			mui.plusReady(function() {

				//不显示滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});

				//监听返回键
				plus.key.addEventListener('backbutton',
					function() {
						plus.webview.currentWebview().close();
					})

				var customer = JSON.parse(plus.storage.getItem('customer'));
				var balanceVo = JSON.parse(plus.storage.getItem('balanceVo'));
				notifiUL(customer, balanceVo);
				
				getCustomerBalance(customer.id,1,100);
			})

			function notifiUL(customer, balanceVo) {
				plus.nativeUI.closeWaiting();
				var updateTime = document.getElementById('updateTime');
				updateTime.innerText = balanceVo.updatedAt;

				//drawProgressbar(balanceVo.balance, 5000);

			}
			
			function getCustomerBalance(customerId, pageNum, pageSize) {
			
				mui.ajax(baseUrl + 'customer/transactionList/' + customerId + "/" + pageNum + "/" + pageSize, {
					data: {
			
					},
					headers: {
						'Accept-Language': "en",
						'Authentication': plus.storage.getItem('Authentication'),
					},
					dataType: 'json',
					type: 'get',
					success: function(result) {
						if (result.code == 200) {
							var data = result.data;
							notifiULList(data.list);
			
						}
			
					}
				});
			}

			function notifiULList(data) {
				var doc = document,
					fragment = doc.createDocumentFragment(),
					container = doc.getElementById("card");
				//遍历数组
				mui.each(data, function(i, item) {
					var doc = document,
						div1 = doc.createElement("div"),
						div = doc.createElement("div"),
						p1 = doc.createElement("p"),
						p2 = doc.createElement("p"),
						div3 = doc.createElement("div"),
						p3 = doc.createElement("p"),
						div4 = doc.createElement("div"),
						div2 = doc.createElement("div");
					div1.setAttribute('style', 'display: flex;flex-direction: row;height: 80px;width: 100%;')
					div2.setAttribute('style', 'display: flex;flex-direction: column;justify-content: space-around;flex: 1;')
					p1.innerText = item.transactionDate
					p2.innerText =item.shopName
					p2.setAttribute('style', 'font-size: 16px;color: black;')
					div3.setAttribute('style', 'flex: 0 0 120px;display: flex;justify-content: center;align-items: center;')
					p3.setAttribute('style', 'font-size: 18px;color: red;')
					var point = (item.pointAdjustment>0)?'+'+item.pointAdjustment:item.pointAdjustment;
					p3.innerText = point + ' Points'
					div4.setAttribute('style', 'width: 100%;height: 1px;background: #CCCCCC;')
					div2.appendChild(p1)
					div2.appendChild(p2)
					div1.appendChild(div2)
					div1.appendChild(div3)
					div3.appendChild(p3)
					div.appendChild(div1)
					div.appendChild(div4)
					fragment.appendChild(div);
				});
				container.appendChild(fragment);
			}
		</script>
		<header class="mui-bar mui-bar-nav" style="background: red;box-shadow:0px 1px 5px #B6B6B6">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #FFFFFF;"></a>
			<h1 class="mui-title" style="color:  #FFFFFF;font-weight: bold;font-size: 20px;">ePoint Balance</h1>
		</header>



		<div class="mui-content " style="width: 100%;display: flex;flex-direction: column;justify-content: flex-start;overflow-y: auto;min-height: 100%;">

			<!-- <div class="mui-scroll"> -->

			<p style="font-size: 17px;text-align: center;font-weight: bold;color: #6D6D72;margin: 3px;">Latest 30 ePoint
				Records(Including refunded and
				returned transactions)</p>
			<div style="display: flex;width: 100%;flex-direction: column;align-items: center;">
				<canvas id="progressbar" width="180" height="180"></canvas>
				<p style="font-size: 18px;margin-top: 5px;">Last Updated at <span id="updateTime"></span></p>
			</div>
			<div class="mui-card" style="flex: 1;">
				<div class="mui-card-content" style="padding: 10px;">
					<p style="font-size: 16px; font-weight: bold;color: #6D6D72;">Translation History</p>

					<div style="width: 100%;height: 1px;background: #CCCCCC;"></div>

					<div id="card">
						<!-- <div>
	<div style="display: flex;flex-direction: row;height: 80px;width: 100%;">
		<div style="display: flex;flex-direction: column;justify-content: space-around;flex: 1;">
			<p>15/07/2019 17:50</p>
			<p>Customer Service Adjustment</p>
		</div>
		<div style="flex: 0 0 120px;display: flex;justify-content: center;align-items: center;">
			<p style="font-size: 16px;color: red;">+ 2,500 Points</p>
		</div>
	</div>
	<div style="width: 100%;height: 1px;background: #CCCCCC;"></div>
</div> -->


					</div>
				</div>

			</div>
		</div>
		<!-- </div> -->
	</body>

</html>
