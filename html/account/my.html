<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.css" rel="stylesheet" />
		<script src="../../js/mui.js"></script>
	</head>

	<body>
		<script src="../../js/environment.js"></script>
		<script type="text/javascript">
			mui.init({
				keyEventBind: {
					backbutton: false, //Boolean(默认true)关闭back按键监听
					menubutton: false //Boolean(默认true)关闭menu按键监听
				},
				preloadPages: [{
					url: '../coupon/redeemCoupon.html',
					id: 'redeemCoupon.html'
				}],
			})
			var customerId = null;
			mui.plusReady(function() {

				customerId = plus.storage.getItem('customerId');
				if (customerId != null) {
					
					document.getElementById('divContent').classList.remove('mui-hidden');
					document.getElementById('divLogin').classList.add('mui-hidden');
					
					var customer = JSON.parse(plus.storage.getItem('customer'));
					var balanceVo = JSON.parse(plus.storage.getItem('balanceVo'));
					notifiUL(customer, balanceVo);

				} else {
					document.getElementById('divContent').classList.add('mui-hidden');
					document.getElementById('divLogin').classList.remove('mui-hidden');
				}
			});


			function notifiUL(customer, balanceVo) {
				plus.nativeUI.closeWaiting();
				var userName = document.getElementById('userName');
				userName.innerHTML = customer.firstName;

				var points = document.getElementById('points');
				points.innerText = balanceVo.balance;

				var pointsTips = document.getElementById('pointsTips');
				pointsTips.innerHTML = 'ePonit';
				var moneyTips = document.getElementById('moneyTips');
				moneyTips.innerHTML = "Euivalent to $ " + balanceVo.balance / 100;
				var head = document.getElementById('head');

			}

			function toSetting() {
				mui.openWindow({
					url: '../home/homeSet.html',
					id: 'setting.html'
				});
			}

			var page = null;

			function toCashCoupon() {
				var id = '88'
				// 获得详情页面
				if (!page) {
					page = plus.webview.getWebviewById('redeemCoupon.html');
				}
				//触发详情页面的couponId事件
				mui.fire(page, 'couponId', {
					id: id
				});

				if (customerId != null) {
					mui.openWindow({
						url: '../coupon/redeemCoupon.html',
						id: 'redeemCoupon.html'
					});
				} else {
					mui.openWindow({
						url: '../login/login.html',
						id: 'login.html'
					});
				}

			}

			function toPersonal() {

				if (customerId != null) {
					mui.openWindow({
						url: '../home/personalMsg.html',
						id: 'personalMsg.html'
					});
				} else {
					mui.openWindow({
						url: '../login/login.html',
						id: 'login.html'
					});
				}
			}
		</script>

		<!-- <header class="mui-bar mui-bar-nav">
      <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
      <h1 class="mui-title">标题</h1>
    </header> -->
		<div style="display: flex;flex-direction: column;" class="mui-content">
			<div style="background: #EE5B5B;width: 100%;height: 200px;position: absolute;top: 0;left: 0;z-index: 1;"></div>
			<div class="mui-card" style="z-index: 10;margin: 50px 20px 20px 20px;border-radius: 20px;box-shadow: 0px 0px 0px #413D4A">
				<div class="mui-card-content" style="padding: 15px;">
					<!-- 已登录状态 -->
					<div id="divContent" class="mui-hidden">
					<div style="height: 80px;width: 100%;display: flex;flex-direction: row;align-items: center;">
						<img src="../../img/one.jpg" id="head" style="width: 80px; height: 80px;border-radius: 80px;" onclick="toPersonal()" />
						<div style="flex: 1;padding: 15px;">
							<span style="font-size: 20px;color: #6D6D72;font-weight: bold;" id="userName"></span>
						</div>
						<img src="../../img/my_setting.png" style="width: 30px; height: 30px;" onclick="toSetting()" />
					</div>
					<div style="height: 80px;width: 100%;padding: 15px;">
						<span style="color: #D44A38;font-size: 26px;font-weight: bold;"
						 id="points"></span>
						<p style="font-size: 20px;padding-left: 5px;font-weight: bold;display: inline;" id="pointsTips">ePoint</p>
						<p style="font-size: 18px;margin-top: 10px;" id="moneyTips"></p>
					</div>
					</div>
					<!-- 未登录状态  -->
					<div id="divLogin" class="mui-hidden">
						<div style="height: 80px;width: 100%;display: flex;flex-direction: row;justify-content: center;align-items: center;">
							<img src="../../img/nodata-search.png" style="width: 80px; height: 80px;border-radius: 80px;" onclick="toPersonal()" />
						</div>
						<div style="height: 80px;width: 100%;padding: 15px;display: flex;flex-direction: column;justify-content: center;align-items: center;">
							<div style="flex: 1;padding: 15px;">
								<span style="font-size: 20px;color: #6D6D72;font-weight: bold;">Login WingOn Reward</span>
							</div>
						</div>
						</div>
					</div>
				</div>
				
			</div>

			<div class="mui-card" style="z-index: 10;box-shadow: 0px 0px 0px #413D4A">
				<div class="mui-card-content" style="padding: 10px;">
					<p style="font-size: 18px;color: black;font-weight: bold;">Service</p>
					<div style="width: 100%;height: 2px;background: #CCCCCC;"></div>
					<div style="display: flex;flex-direction: row;width: 100%;height: 70px;align-items: center;" onclick="toCashCoupon()">
						<img src="../../img/service_redeem.png" style="width: 40px;height: 40px;" />
						<p style="overflow: hidden;padding: 5px 0 0 10px;font-size: 18px;flex: 1;font-weight: bold;">Redeem Cash Coupons</p>
						<span class="mui-icon mui-icon-forward" style="color: #BBBBBB;"></span>
					</div>
				</div>
			</div>
			<div style="height: 70px;width: 70px;position: fixed;bottom: -56px;left: calc(50% - 35px);background: #EE5B5B;border-radius: 50%;"></div>
		</div>
	</body>

</html>
